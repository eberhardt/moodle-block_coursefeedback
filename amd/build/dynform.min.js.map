{"version":3,"file":"dynform.min.js","sources":["../src/dynform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manager for the coursefeedback blocks rankingpage (ranking.php).\n *\n * @module      block_coursefeedback\n * @copyright   2022 onwards Felix Di Lenarda (@ innoCampus, TU Berlin)\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport jQuery from 'jquery';\nimport * as Str from 'core/str';\n\n/**\n * Used for the ranking page\n * Initialise\n */\nexport const init = () => {\n    // Eventlistener for changing the selected feedback.\n    jQuery('#id_feedback').change(function() {\n        let selectedfeedback = jQuery('#id_feedback').val();\n        let promises = Ajax.call([{\n            methodname: 'block_coursefeedback_get_feedback_questions',\n            args: {feedbackid: selectedfeedback}\n        }]);\n        promises[0].done(function (data) {\n            // Populate question options.\n            window.console.debug(\"AJAX FEEDBACK DONE\");\n            jQuery('#id_question').html('');\n            let choosestr = Str.get_string('form_option_choose', 'block_coursefeedback');\n            choosestr.done(function (string) {\n                jQuery('<option/>').val('-1').html(string).appendTo('#id_question');\n                data.questions.forEach(function(quest) {\n                    window.console.debug(quest);\n                    jQuery('<option/>').val(quest.id).html(quest.question).appendTo('#id_question');\n                });\n            });\n\n            return;\n        }).fail(function (ex) {\n            window.console.debug(\"ajax fAIL\");\n            window.console.debug(ex);\n        });\n        window.console.debug(selectedfeedback);\n    });\n\n    // Eventlistener for changing the selected question.\n    jQuery('#id_question').change(function() {\n        let selectedquestion = jQuery('#id_question').val();\n        let answerlimit = 0;\n        let showperpage = 200;\n        let page = 1;\n        // Get rankings.\n        let promises = Ajax.call([{\n            methodname: 'block_coursefeedback_get_ranking_for_question',\n            args: {\n                id: selectedquestion,\n                answerlimit: answerlimit,\n                showperpage: showperpage,\n                page: page\n            }\n        }]);\n        promises[0].done(function (questiondata) {\n            window.console.debug(\"AJAX QUESTION DONE\");\n            // Reset rankingtable.\n            let table = window.document.getElementById('coursefeedback_table');\n            let tbody = table.getElementsByTagName('tbody')[0];\n            tbody.innerHTML = '';\n\n            // Populate rankingtable.\n            questiondata.ranking.forEach(function(course) {\n                let row = tbody.insertRow();\n                var cell1 = row.insertCell(0);\n                var cell2 = row.insertCell(1);\n                var cell3 = row.insertCell(2);\n                cell1.innerHTML = course.courseid;\n                cell2.innerHTML = course.answerstotal;\n                cell3.innerHTML = course.avfeedbackresult;\n            });\n\n            return;\n        }).fail(function (ex) {\n            window.console.debug(\"ajax QUESTION fAIL\");\n            window.console.debug(ex);\n        });\n    });\n\n    // Eventlistener to download FB CSV.\n    jQuery('#id_downloadfb').click( function() {\n        let url = new URL(window.location);\n        url.searchParams.append('action', 'download');\n        url.searchParams.append('feedback', jQuery('#id_feedback').val());\n        window.location.href = url;\n    });\n\n    // Eventlistener to download FB-question CSV.\n    jQuery('#id_downloadqu').click( function() {\n        let url = new URL(window.location);\n        url.searchParams.append('action', 'download');\n        url.searchParams.append('feedback', jQuery('#id_feedback').val());\n        url.searchParams.append('question', jQuery('#id_question').val());\n        window.location.href = url;\n    });\n    window.onbeforeunload = null;\n};"],"names":["change","selectedfeedback","val","Ajax","call","methodname","args","feedbackid","done","data","window","console","debug","html","Str","get_string","string","appendTo","questions","forEach","quest","id","question","fail","ex","selectedquestion","answerlimit","showperpage","page","questiondata","tbody","document","getElementById","getElementsByTagName","innerHTML","ranking","course","row","insertRow","cell1","insertCell","cell2","cell3","courseid","answerstotal","avfeedbackresult","click","url","URL","location","searchParams","append","href","onbeforeunload"],"mappings":";;;;;;;q0BA+BoB,+BAET,gBAAgBA,QAAO,eACtBC,kBAAmB,mBAAO,gBAAgBC,MAC/BC,cAAKC,KAAK,CAAC,CACtBC,WAAY,8CACZC,KAAM,CAACC,WAAYN,qBAEd,GAAGO,MAAK,SAAUC,MAEvBC,OAAOC,QAAQC,MAAM,0CACd,gBAAgBC,KAAK,IACZC,IAAIC,WAAW,qBAAsB,wBAC3CP,MAAK,SAAUQ,4BACd,aAAad,IAAI,MAAMW,KAAKG,QAAQC,SAAS,gBACpDR,KAAKS,UAAUC,SAAQ,SAASC,OAC5BV,OAAOC,QAAQC,MAAMQ,2BACd,aAAalB,IAAIkB,MAAMC,IAAIR,KAAKO,MAAME,UAAUL,SAAS,yBAKzEM,MAAK,SAAUC,IACdd,OAAOC,QAAQC,MAAM,aACrBF,OAAOC,QAAQC,MAAMY,OAEzBd,OAAOC,QAAQC,MAAMX,yCAIlB,gBAAgBD,QAAO,eACtByB,kBAAmB,mBAAO,gBAAgBvB,MAK/BC,cAAKC,KAAK,CAAC,CACtBC,WAAY,gDACZC,KAAM,CACFe,GAAII,iBACJC,YARU,EASVC,YARU,IASVC,KARG,MAWF,GAAGpB,MAAK,SAAUqB,cACvBnB,OAAOC,QAAQC,MAAM,0BAGjBkB,MADQpB,OAAOqB,SAASC,eAAe,wBACzBC,qBAAqB,SAAS,GAChDH,MAAMI,UAAY,GAGlBL,aAAaM,QAAQhB,SAAQ,SAASiB,YAC9BC,IAAMP,MAAMQ,YACZC,MAAQF,IAAIG,WAAW,GACvBC,MAAQJ,IAAIG,WAAW,GACvBE,MAAQL,IAAIG,WAAW,GAC3BD,MAAML,UAAYE,OAAOO,SACzBF,MAAMP,UAAYE,OAAOQ,aACzBF,MAAMR,UAAYE,OAAOS,uBAI9BtB,MAAK,SAAUC,IACdd,OAAOC,QAAQC,MAAM,sBACrBF,OAAOC,QAAQC,MAAMY,8BAKtB,kBAAkBsB,OAAO,eACxBC,IAAM,IAAIC,IAAItC,OAAOuC,UACzBF,IAAIG,aAAaC,OAAO,SAAU,YAClCJ,IAAIG,aAAaC,OAAO,YAAY,mBAAO,gBAAgBjD,OAC3DQ,OAAOuC,SAASG,KAAOL,2BAIpB,kBAAkBD,OAAO,eACxBC,IAAM,IAAIC,IAAItC,OAAOuC,UACzBF,IAAIG,aAAaC,OAAO,SAAU,YAClCJ,IAAIG,aAAaC,OAAO,YAAY,mBAAO,gBAAgBjD,OAC3D6C,IAAIG,aAAaC,OAAO,YAAY,mBAAO,gBAAgBjD,OAC3DQ,OAAOuC,SAASG,KAAOL,OAE3BrC,OAAO2C,eAAiB"}