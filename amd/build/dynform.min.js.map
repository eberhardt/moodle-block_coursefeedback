{"version":3,"file":"dynform.min.js","sources":["../src/dynform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manager for the coursefeedback blocks rankingpage (ranking.php).\n *\n * @module      block_coursefeedback\n * @copyright   2022 onwards Felix Di Lenarda (@ innoCampus, TU Berlin)\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport jQuery from 'jquery';\nimport * as Str from 'core/str';\n\n/**\n * reset table\n *\n */\nfunction resetTable() {\n    jQuery('#coursefeedback_table').find('tbody').html('');\n}\n\n/**\n * Used for the ranking page\n * Initialise\n */\nexport const init = () => {\n\n    let downQuest = jQuery('#id_downloadqu');\n    let downFeed = jQuery('#id_downloadfb');\n\n    // Initially hide the downloadbuttons ($mform->hideIF unfortunately doesn't work properly in this case)\n    downQuest.hide();\n    downFeed.hide();\n\n    // Eventlistener for changing the selected feedback.\n    jQuery('#id_feedback').change(function () {\n        let selectedFeedback = jQuery('#id_feedback').val();\n\n        // Check if a valid fb is selected\n        if (selectedFeedback == '0') {\n            downFeed.hide();\n        } else {\n            downFeed.show();\n        }\n\n        // Get fb questions\n        let promises = Ajax.call([{\n            methodname: 'block_coursefeedback_get_feedback_questions',\n            args: {feedbackid: selectedFeedback}\n        }]);\n        promises[0].done(function (data) {\n            // Populate question options.\n            window.console.debug(\"AJAX FEEDBACK DONE\");\n            jQuery('#id_question').html('');\n            let chooseStr = Str.get_string('form_option_choose', 'block_coursefeedback');\n            chooseStr.done(function (string) {\n                jQuery('<option/>').val('0').html(string).appendTo('#id_question');\n                data.questions.forEach(function (quest) {\n                    window.console.debug(quest);\n                    jQuery('<option/>').val(quest.questionid).html(quest.question).appendTo('#id_question');\n                });\n            });\n\n            // Hide and reset downloadqu button and reset table\n            jQuery('#id_question').val('0');\n            downQuest.hide();\n            resetTable();\n\n            return;\n        }).fail(function (ex) {\n            window.console.debug(\"ajax fAIL\");\n            window.console.debug(ex);\n        });\n        window.console.debug(selectedFeedback);\n    });\n\n    // Eventlistener for changing the selected question.\n    jQuery('#id_question').change(function() {\n        let selectedQuestion = jQuery('#id_question').val();\n        let selectedFb = jQuery('#id_feedback').val();\n        // Check if a valid question is selected\n        if (selectedQuestion == '0') {\n            downQuest.hide();\n            resetTable();\n            return;\n        } else {\n            downQuest.show();\n        }\n\n        let answerLimit = 0;\n        let showPerPage = 200;\n        let page = 1;\n        // Get rankings.\n        let promises = Ajax.call([{\n            methodname: 'block_coursefeedback_get_ranking_for_question',\n            args: {\n                questionid: selectedQuestion,\n                feedback: selectedFb,\n                answerlimit: answerLimit,\n                showperpage: showPerPage,\n                page: page\n            }\n        }]);\n        promises[0].done(function (questiondata) {\n            // Reset rankingtable.\n            resetTable();\n            let table = window.document.getElementById('coursefeedback_table');\n            let tBody = table.getElementsByTagName('tbody')[0];\n            // Populate rankingtable.\n            questiondata.ranking.forEach(function(course) {\n                let row = tBody.insertRow();\n                var cell1 = row.insertCell(0);\n                var cell2 = row.insertCell(1);\n                var cell3 = row.insertCell(2);\n                cell1.innerHTML = course.courseid;\n                cell2.innerHTML = course.answerstotal;\n                cell3.innerHTML = course.avfeedbackresult;\n            });\n\n            return;\n        }).fail(function (ex) {\n            window.console.debug(ex);\n        });\n    });\n\n    // Don't ask if user really wants to leave the page\n    window.onbeforeunload = null;\n};"],"names":["resetTable","find","html","downQuest","downFeed","hide","change","selectedFeedback","val","show","Ajax","call","methodname","args","feedbackid","done","data","window","console","debug","Str","get_string","string","appendTo","questions","forEach","quest","questionid","question","fail","ex","selectedQuestion","selectedFb","feedback","answerlimit","showperpage","page","questiondata","tBody","document","getElementById","getElementsByTagName","ranking","course","row","insertRow","cell1","insertCell","cell2","cell3","innerHTML","courseid","answerstotal","avfeedbackresult","onbeforeunload"],"mappings":";;;;;;;cA+BSA,iCACE,yBAAyBC,KAAK,SAASC,KAAK,o0BAOnC,eAEZC,WAAY,mBAAO,kBACnBC,UAAW,mBAAO,kBAGtBD,UAAUE,OACVD,SAASC,2BAGF,gBAAgBC,QAAO,eACtBC,kBAAmB,mBAAO,gBAAgBC,MAGtB,KAApBD,iBACAH,SAASC,OAETD,SAASK,OAIEC,cAAKC,KAAK,CAAC,CACtBC,WAAY,8CACZC,KAAM,CAACC,WAAYP,qBAEd,GAAGQ,MAAK,SAAUC,MAEvBC,OAAOC,QAAQC,MAAM,0CACd,gBAAgBjB,KAAK,IACZkB,IAAIC,WAAW,qBAAsB,wBAC3CN,MAAK,SAAUO,4BACd,aAAad,IAAI,KAAKN,KAAKoB,QAAQC,SAAS,gBACnDP,KAAKQ,UAAUC,SAAQ,SAAUC,OAC7BT,OAAOC,QAAQC,MAAMO,2BACd,aAAalB,IAAIkB,MAAMC,YAAYzB,KAAKwB,MAAME,UAAUL,SAAS,0CAKzE,gBAAgBf,IAAI,KAC3BL,UAAUE,OACVL,gBAGD6B,MAAK,SAAUC,IACdb,OAAOC,QAAQC,MAAM,aACrBF,OAAOC,QAAQC,MAAMW,OAEzBb,OAAOC,QAAQC,MAAMZ,yCAIlB,gBAAgBD,QAAO,eACtByB,kBAAmB,mBAAO,gBAAgBvB,MAC1CwB,YAAa,mBAAO,gBAAgBxB,SAEhB,KAApBuB,wBACA5B,UAAUE,YACVL,aAGAG,UAAUM,OAOCC,cAAKC,KAAK,CAAC,CACtBC,WAAY,gDACZC,KAAM,CACFc,WAAYI,iBACZE,SAAUD,WACVE,YATU,EAUVC,YATU,IAUVC,KATG,MAYF,GAAGrB,MAAK,SAAUsB,cAEvBrC,iBAEIsC,MADQrB,OAAOsB,SAASC,eAAe,wBACzBC,qBAAqB,SAAS,GAEhDJ,aAAaK,QAAQjB,SAAQ,SAASkB,YAC9BC,IAAMN,MAAMO,YACZC,MAAQF,IAAIG,WAAW,GACvBC,MAAQJ,IAAIG,WAAW,GACvBE,MAAQL,IAAIG,WAAW,GAC3BD,MAAMI,UAAYP,OAAOQ,SACzBH,MAAME,UAAYP,OAAOS,aACzBH,MAAMC,UAAYP,OAAOU,uBAI9BxB,MAAK,SAAUC,IACdb,OAAOC,QAAQC,MAAMW,UAK7Bb,OAAOqC,eAAiB"}